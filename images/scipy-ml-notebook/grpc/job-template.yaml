apiVersion: batch/v1
kind: Job
metadata:
  name: gpu-test-job
  namespace: test-server
spec:
  template:
  
    spec:
      # affinity:
      #   nodeAffinity:
      #     requiredDuringSchedulingIgnoredDuringExecution:
      #       nodeSelectorTerms:
      #       - matchExpressions:
      #         - key: gputype
      #           operator: Exists
      containers:
      - name: tensorflow-pytorch-tester
        image: 
        resources: 
          limits:
            cpu: "2"
            memory: 8Gi
            nvidia.com/gpu: "1" 
          requests:
            cpu: "1"
            memory: 8Gi
            nvidia.com/gpu: "1"
        command: ["python",  "/job-script/script.py"]
        env:
        - name: TF_CPP_MIN_LOG_LEVEL
          value: '3'
        volumeMounts:
        - mountPath: /job-script
          name: job-script
      volumes:
      - name: job-script
        nfs:
          server: its-dsmlpdev-fs01.ucsd.edu
          path: /export/apps/gpu-tester/job-script
      restartPolicy: Never
  backoffLimit: 4

